(()=>{function e(e){return`${t(e.getDate().toString(),"day")}/${t(e.getMonth().toString(),"month")}/${e.getFullYear()}`}function t(e,t){return 1===e.length?"month"===t?`0${parseInt(e)+1}`:`0${e}`:"month"===t?parseInt(e)+1:e}function n(e,t){let n,s,a,i=[];return[e,t].forEach((e=>{if(void 0===e)return i;n=1===e.getHours().toString().length?`0${e.getHours()}`:e.getHours(),s=1===e.getMinutes().toString().length?`0${e.getMinutes()}`:e.getMinutes(),a=`${n}:${s}`,i.push(a)})),i}function s(e,t){let n=new Date(e);return n.setDate(e.getDate()+t),n}function a(e,t,s){let a=s.sort(((e,t)=>e.start>t.start?1:-1)),i=[[e,e]],r=[];return a.forEach((n=>{Date.parse(`01/01/2011 ${e}`)<=Date.parse(`01/01/2011 ${n.start}`)<Date.parse(`01/01/2011  ${t}`)&&i.push([n.start,n.end])})),i.push([t,t]),i.forEach(((e,t)=>{if(t>0&&new Date(`01/01/2011 ${i[t][0]}`)-new Date(`01/01/2011 ${i[t-1][1]}`)>0){let e=new Date(`01/01/2011 ${i[t-1][1]}`),s=structuredClone(e),a=Math.abs(new Date(`01/01/2011 ${i[t][0]}`)-new Date(`01/01/2011 ${i[t-1][1]}`))/36e5*60,o=new Date(s.setMinutes(s.getMinutes()+a));a>=30&&r.push(n(e,o))}})),r}!async function(){let t=await async function(){let t=function(e){let t={};for(availableDateIndex in e){let s=[];for(freeSlotsIndex in e[availableDateIndex].free_slots){let a=new Date(`01/01/2011 ${e[availableDateIndex].free_slots[freeSlotsIndex][0]}`),i=new Date(`01/01/2011 ${e[availableDateIndex].free_slots[freeSlotsIndex][1]}`),r=a;for(;r<i;){let e,t=["00","15","30","45"],a=1===r.getMinutes().toString().length?`0${r.getMinutes()}`:`${r.getMinutes()}`;if(t.includes(a)){let e=structuredClone(r);if(e.setMinutes(e.getMinutes()+30),!(e<=i))break;s.includes(r)||(s=s.concat(n(r))),r=new Date(r.setMinutes(r.getMinutes()+15))}else{t.push(a),t.sort();let n=t.indexOf(a);e=a>"44"?60-parseInt(t[n]):parseInt(t[n+1])-parseInt(t[n]),r=new Date(r.setMinutes(r.getMinutes()+e))}}s.sort(),t[e[availableDateIndex].date]=s}}return t}(function(t,n,i){let r=new Date,o=[],u=[];for(let e=0;e<20;e++)o.push(s(r,e));for(dateIndex in o){let t=o[dateIndex],s=t.getDay(),r=e(t),l=n.filter((e=>e.weekday==s));for(agendaIndex in l){let e=[];l[agendaIndex].physiotherapist_id in i&&r in i[l[agendaIndex].physiotherapist_id]&&(e=i[l[agendaIndex].physiotherapist_id][r]);let t=a(l[agendaIndex].start_hour,l[agendaIndex].end_hour,e);if(t){let e={date:r,free_slots:t};u.push(e)}}}return u}(0,await async function(){let e=components.screening__physiotherapist_id.value,t=await executeAction("getphysioagenda",null,{physiotherapist_id:e});return"Success"===t&&(t=[]),daysInWeek={domingo:0,"segunda-feira":1,"terça-feira":2,"quarta-feira":3,"quinta-feira":4,"sexta-feira":5,sábado:6},t.forEach((e=>{e.weekday in daysInWeek&&(e.weekday=daysInWeek[e.weekday])})),t}(),await async function(t){let n=new Date;n.setDate(n.getDate()+20);let s=n.toJSON().slice(0,10).replace(/-/g,"-"),a={},i=await executeAction("getphysioscreenings",null,{end_date:s});return"Success"===i&&(i=[]),i.forEach((t=>{let n={},s="",i=t.physiotherapist_id,r=t.schedule_date.slice(0,-1).split("T"),o=new Date(r);o.setMinutes(o.getMinutes()+30);let u=1===o.getHours().toString().length?`0${o.getHours()}`:o.getHours(),l=1===o.getMinutes().toString().length?`0${o.getMinutes()}`:o.getMinutes();n={start:r[1].substring(0,5),end:`${u}:${l}`},s=e(o),Object.keys(a).includes(i.toString())?(Object.keys(a[i]).includes(s)||(a[i][s]=[]),a[i][s].push(n)):a[i]={[s]:[n]}})),a}())),i=new Date;i.setMinutes(i.getMinutes()+120);let r=e(i),o=`${1===i.getHours().toString().length?`0${i.getHours()}`:i.getHours()}:${1===i.getMinutes().toString().length?`0${i.getMinutes()}`:i.getMinutes()}`,u=[];if(r in t){for(availableTimeIndex in t[r])t[r][availableTimeIndex]>o&&u.push(t[r][availableTimeIndex]);u.length>0?t[r]=u:t.pop(r)}return t}(),i=function(e){return Object.keys(e)}(t),r=[];i.forEach((e=>{r.push({label:e,value:e})})),components.screening__schedule_date2.options=r,components.screening__schedule_date2.onChange((()=>{let e=components.screening__schedule_date2.value;if(e){let n=function(e,t){return e[t]}(t,e),s=[];n.forEach((e=>{s=s.concat({label:e,value:e})})),components.screening__schedule_hour.options=s,components.screening__schedule_hour.value=""}else components.screening__schedule_hour.value=""})),components.screening__schedule_hour.onChange((async()=>{let e=components.screening__schedule_date2.value,t=components.screening__schedule_hour.value;components.screening__schedule_date.value=e+" "+t}))}()})();